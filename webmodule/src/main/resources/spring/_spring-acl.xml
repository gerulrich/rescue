<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:security="http://www.springframework.org/schema/security"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-2.0.1.xsd">

	<!-- ========= ACL SERVICE DEFINITIONS ========= -->

<!-- 	<bean id="aclCache" class="net.cloudengine.service.acl.NullAclCache"> -->
<!-- 		<constructor-arg> -->
<!-- 			<bean class="org.springframework.cache.ehcache.EhCacheFactoryBean"> -->
<!-- 				<property name="cacheManager"> -->
<!-- 					<bean class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean" /> -->
<!-- 				</property> -->
<!-- 				<property name="cacheName" value="aclCache" /> -->
<!-- 			</bean> -->
<!-- 		</constructor-arg> -->
<!-- 	</bean> -->

<!-- 	<bean id="lookupStrategy" -->
<!-- 		class="org.springframework.security.acls.jdbc.BasicLookupStrategy"> -->
<!-- 		<constructor-arg ref="dataSource" /> -->
<!-- 		<constructor-arg ref="aclCache" /> -->
<!-- 		<constructor-arg> -->
<!-- 			<bean -->
<!-- 				class="org.springframework.security.acls.domain.AclAuthorizationStrategyImpl"> -->
<!-- 				<constructor-arg> -->
<!-- 					<list> -->
<!-- 						<bean -->
<!-- 							class="org.springframework.security.core.authority.GrantedAuthorityImpl"> -->
<!-- 							<constructor-arg value="ROLE_ADMIN" /> -->
<!-- 						</bean> -->
<!-- 						<bean -->
<!-- 							class="org.springframework.security.core.authority.GrantedAuthorityImpl"> -->
<!-- 							<constructor-arg value="ROLE_ADMIN" /> -->
<!-- 						</bean> -->
<!-- 						<bean -->
<!-- 							class="org.springframework.security.core.authority.GrantedAuthorityImpl"> -->
<!-- 							<constructor-arg value="ROLE_ADMIN" /> -->
<!-- 						</bean> -->
<!-- 					</list> -->
<!-- 				</constructor-arg> -->
<!-- 			</bean> -->
<!-- 		</constructor-arg> -->
<!-- 		<constructor-arg> -->
<!-- 			<bean class="org.springframework.security.acls.domain.ConsoleAuditLogger" /> -->
<!-- 		</constructor-arg> -->
<!-- 		<property name="permissionFactory" ref="customPermissionFactory" /> -->
<!-- 	</bean> -->

	<bean id="customPermissionFactory" class="net.cloudengine.model.auth.CustomPermissionFactory" />


	<bean id="aclService" class="net.cloudengine.service.acl.MongoMutableAclServiceImpl">
<!-- 		<constructor-arg ref="dataSource" /> -->
<!-- 		<constructor-arg ref="lookupStrategy" /> -->
<!-- 		<constructor-arg ref="aclCache" /> -->
<!-- 		<property name="classIdentityQuery" value="SELECT LAST_INSERT_ID();" /> -->
<!-- 		<property name="sidIdentityQuery" value="SELECT LAST_INSERT_ID();" /> -->
	</bean>


	<bean id="expressionHandler" class="org.springframework.security.access.expression.method.DefaultMethodSecurityExpressionHandler">
		<property name="permissionEvaluator" ref="permissionEvaluator" />
	</bean>

	<bean id="permissionEvaluator" class="org.springframework.security.acls.AclPermissionEvaluator">
		<constructor-arg ref="aclService" />
		<property name="permissionFactory" ref="customPermissionFactory" />
	</bean>

</beans>